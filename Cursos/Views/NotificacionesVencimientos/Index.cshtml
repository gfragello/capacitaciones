@model IEnumerable<Cursos.Models.NotificacionVencimiento>

@{
    ViewBag.Title = "Notificación de vencimientos";
}

<h4>Notificación de vencimientos</h4>

<p style="vertical-align: middle;">
    <a href="@Url.Action("Index") "><span class="glyphicon glyphicon-envelope" style="font-size: 25px; color: #017d49"></span>&nbsp;Enviar todas las notificaciones pendientes</a>
</p>

<hr />

@foreach (var notificacionesEmpresa in Model.GroupBy(n => n.RegistroCapacitacion.Capacitado.EmpresaID))
{
    string emailEmpresa = notificacionesEmpresa.First().RegistroCapacitacion.Capacitado.Empresa.Email;

    <h4>
        @notificacionesEmpresa.First().RegistroCapacitacion.Capacitado.Empresa.NombreFantasia 
        &nbsp;&nbsp;
        @if (!string.IsNullOrEmpty(emailEmpresa))
        {
            <a href="@Url.Action("Index")"><span class="glyphicon glyphicon-envelope" style="color: #017d49" /></a>
        }
        else
        {
            <span class="glyphicon glyphicon-envelope" style="color: darkgrey" />
        }
    </h4>

    if (!string.IsNullOrEmpty(emailEmpresa))
    {
        <span style="font-size: small">@emailEmpresa</span>
    }
    else
    {
        <span style="font-size: small"><span style="font-weight: bold">Atención!</span> La empresa no tiene mail definido</span>
    }

    <br /><br />

    <table class="table table-striped">

        <tr>
            <th style="width: 50%">
                Capacitado
            </th>
            <th style="width: 20%">
                Curso
            </th>
            <th style="width: 20%">
                Vencimiento
            </th>
            <th style="width: 10%"></th>
        </tr>

    @foreach (var item in notificacionesEmpresa)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.RegistroCapacitacion.Capacitado.NombreCompleto)
            </td>
            <td>
                <span class="label label-default" style="color: #333333; background-color: @item.RegistroCapacitacion.Jornada.Curso.ColorDeFondo">
                    @Html.DisplayFor(modelItem => item.RegistroCapacitacion.Jornada.Curso.Descripcion)
                </span>
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.RegistroCapacitacion.FechaVencimiento)
            </td>
            <td>
                <a href="@Url.Action("Index") "><span class="glyphicon glyphicon-envelope" style="font-size: 25px; color: #017d49" /></a>
            </td>
        </tr>
    }
    </table>
}
